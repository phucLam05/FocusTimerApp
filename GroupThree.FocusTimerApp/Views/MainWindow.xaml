<Window x:Class="GroupThree.FocusTimerApp.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:conv="clr-namespace:GroupThree.FocusTimerApp.Converters"
     mc:Ignorable="d"
    Title="Focus Timer" 
  Height="750" Width="500"
 WindowStartupLocation="CenterScreen"
        Background="{DynamicResource WindowBackgroundBrush}"
      WindowStyle="None"
      AllowsTransparency="False"
   ResizeMode="CanMinimize"
        Icon="pack://application:,,,/Assets/app_icon.ico">

    <Window.Resources>
        <conv:ThemeToIconConverter x:Key="ThemeToIconConverter" />
        <conv:ThemeToTextConverter x:Key="ThemeToTextConverter" />
        <conv:BooleanToVisibilityConverter x:Key="BoolToVis" />
        <conv:InverseBooleanToVisibilityConverter x:Key="InverseBoolToVis" />
        <conv:ModeToPomodoroConverter x:Key="ModeToPomodoroConverter" />
        <conv:ModeToTrackingConverter x:Key="ModeToTrackingConverter" />

        <Style x:Key="SidebarModeButton" TargetType="RadioButton">
            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Padding" Value="20,15" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="FontWeight" Value="Medium" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="HorizontalContentAlignment" Value="Left" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border Background="{TemplateBinding Background}"
                   Padding="{TemplateBinding Padding}"
           BorderBrush="{DynamicResource BorderBrush}"
    BorderThickness="0,0,0,1">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" 
        VerticalAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsChecked" Value="True">
                    <Setter Property="Background" Value="{DynamicResource PrimaryButtonBrush}" />
                    <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource SecondaryButtonBrush}" />
                    <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="WindowControlButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Width" Value="40" />
            <Setter Property="Height" Value="40" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="6">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource SecondaryButtonBrush}" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="CloseButton" TargetType="Button" BasedOn="{StaticResource WindowControlButton}">
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource CloseButtonHoverBrush}" />
                    <Setter Property="Foreground" Value="White" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="HamburgerButton" TargetType="ToggleButton">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Width" Value="45" />
            <Setter Property="Height" Value="45" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border Background="{TemplateBinding Background}" CornerRadius="8">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource SecondaryButtonBrush}" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <Storyboard x:Key="ShowSidebarAnimation">
            <DoubleAnimation Storyboard.TargetName="SidebarTransform" Storyboard.TargetProperty="X"
  From="-200" To="0" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut" />
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="SidebarBorder" Storyboard.TargetProperty="Opacity"
        From="0" To="1" Duration="0:0:0.3" />
            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="SidebarOverlay" Storyboard.TargetProperty="Visibility">
                <DiscreteObjectKeyFrame KeyTime="0:0:0" Value="{x:Static Visibility.Visible}" />
            </ObjectAnimationUsingKeyFrames>
            <DoubleAnimation Storyboard.TargetName="SidebarOverlay" Storyboard.TargetProperty="Opacity"
        From="0" To="1" Duration="0:0:0.3" />
        </Storyboard>

        <Storyboard x:Key="HideSidebarAnimation">
            <DoubleAnimation Storyboard.TargetName="SidebarTransform" Storyboard.TargetProperty="X"
                From="0" To="-200" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseIn" />
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="SidebarBorder" Storyboard.TargetProperty="Opacity"
   From="1" To="0" Duration="0:0:0.3" />
            <DoubleAnimation Storyboard.TargetName="SidebarOverlay" Storyboard.TargetProperty="Opacity"
          From="1" To="0" Duration="0:0:0.3" />
            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="SidebarOverlay" Storyboard.TargetProperty="Visibility">
                <DiscreteObjectKeyFrame KeyTime="0:0:0.3" Value="{x:Static Visibility.Collapsed}" />
            </ObjectAnimationUsingKeyFrames>
        </Storyboard>
    </Window.Resources>

    <Grid>
        <!-- SIDEBAR OVERLAY -->
        <Border x:Name="SidebarOverlay" Background="#80000000" Panel.ZIndex="99"
 Opacity="0" Visibility="Collapsed" MouseLeftButtonDown="SidebarOverlay_Click" />

        <!-- SIDEBAR -->
        <Border x:Name="SidebarBorder" Background="{DynamicResource SidebarBackgroundBrush}"
          BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,1,0"
   Width="200" HorizontalAlignment="Left" Panel.ZIndex="100" Opacity="0">
            <Border.RenderTransform>
                <TranslateTransform x:Name="SidebarTransform" X="-200" />
            </Border.RenderTransform>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <Border Grid.Row="0" Background="Transparent" Padding="15,15" BorderBrush="Transparent" BorderThickness="0">
                    <Button HorizontalAlignment="Left" Width="40" Height="40"
              Style="{StaticResource WindowControlButton}"
          Click="CloseSidebarButton_Click" ToolTip="Close Menu">
                        <Path Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" 
       Fill="{DynamicResource TextPrimaryBrush}" Width="14" Height="14" Stretch="Uniform" />
                    </Button>
                </Border>

                <StackPanel Grid.Row="1" Margin="0,10,0,0">
                    <Grid Margin="15,5,15,15">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Rectangle Grid.Column="0" Height="1" Fill="{DynamicResource BorderBrush}" VerticalAlignment="Center" />
                        <TextBlock Grid.Column="1" Text="Timer Modes" FontSize="10" FontWeight="SemiBold"
                   Foreground="{DynamicResource TextSecondaryBrush}" Margin="8,0" VerticalAlignment="Center" />
                        <Rectangle Grid.Column="2" Height="1" Fill="{DynamicResource BorderBrush}" VerticalAlignment="Center" />
                    </Grid>

                    <RadioButton IsChecked="{Binding SelectedMode, Converter={StaticResource ModeToPomodoroConverter}, Mode=TwoWay}"
          GroupName="TimerMode" Style="{StaticResource SidebarModeButton}">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="M12,2C6.48,2 2,6.48 2,12C2,17.52 6.48,22 12,22C17.52,22 22,17.52 22,12C22,6.48 17.52,2 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z"
              Fill="{DynamicResource TextPrimaryBrush}" Width="16" Height="16" Stretch="Uniform" Margin="0,0,8,0" VerticalAlignment="Center" />
                            <TextBlock Text="Pomodoro" VerticalAlignment="Center" />
                        </StackPanel>
                    </RadioButton>

                    <RadioButton IsChecked="{Binding SelectedMode, Converter={StaticResource ModeToTrackingConverter}, Mode=TwoWay}"
              GroupName="TimerMode" Style="{StaticResource SidebarModeButton}">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="M15,1H9V2H15V1M19.04,4.55L20.45,3.13L19.04,1.72L17.62,3.13L19.04,4.55M11,14H13V8H11V14M19,12H22V10H19V12M4.96,5.55L6.37,4.13L4.96,2.72L3.55,4.13L4.96,5.55M1,12H4V10H1V12M11,20H13V22H11V20M17.62,20.87L19.04,19.45L20.45,20.87L19.04,22.28L17.62,20.87M6.37,19.87L4.96,21.28L3.55,19.87L4.96,18.45L6.37,19.87M12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6Z"
      Fill="{DynamicResource TextPrimaryBrush}" Width="16" Height="16" Stretch="Uniform" Margin="0,0,8,0" VerticalAlignment="Center" />
                            <TextBlock Text="Tracking" VerticalAlignment="Center" />
                        </StackPanel>
                    </RadioButton>
                </StackPanel>

                <StackPanel Grid.Row="2" Margin="0,0,0,10">
                    <Border Background="Transparent" Padding="20,15" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,1,0,0">
                        <Button Command="{Binding OpenSettingsCommand}" Background="Transparent" BorderThickness="0"
      HorizontalContentAlignment="Left" Cursor="Hand" Padding="0">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}">
                                        <ContentPresenter />
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                            <StackPanel Orientation="Horizontal">
                                <Path Data="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"
     Fill="{DynamicResource TextSecondaryBrush}" Width="18" Height="18" Stretch="Uniform" Margin="0,0,10,0" />
                                <TextBlock Text="Settings" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="13" VerticalAlignment="Center" />
                            </StackPanel>
                        </Button>
                    </Border>

                    <Border Background="Transparent" Padding="20,15" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,1,0,0">
                        <Button Command="{Binding ToggleThemeCommand}" Background="Transparent" BorderThickness="0"
 HorizontalContentAlignment="Left" Cursor="Hand" Padding="0">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}">
                                        <ContentPresenter />
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                            <StackPanel Orientation="Horizontal">
                                <Path Data="{Binding ThemeService.IsDarkMode, Converter={StaticResource ThemeToIconConverter}}"
       Fill="{DynamicResource TextSecondaryBrush}" Width="18" Height="18" Stretch="Uniform" Margin="0,0,10,0" />
                                <TextBlock Text="{Binding ThemeService.IsDarkMode, Converter={StaticResource ThemeToTextConverter}}"
             Foreground="{DynamicResource TextSecondaryBrush}" FontSize="13" VerticalAlignment="Center" />
                            </StackPanel>
                        </Button>
                    </Border>

                    <TextBlock Text="Select timer mode above" Foreground="{DynamicResource TextSecondaryBrush}"
 FontSize="11" FontStyle="Italic" TextAlignment="Center" Margin="0,10,0,0" Opacity="0.6" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- MAIN CONTENT -->
        <Grid Margin="0,0,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- HEADER -->
            <Border Grid.Row="0" Background="{DynamicResource HeaderBackgroundBrush}" Padding="15,15"
         BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,0,1"
    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                        <ToggleButton x:Name="SidebarToggle" Style="{StaticResource HamburgerButton}" IsChecked="False"
  Checked="SidebarToggle_Checked" Unchecked="SidebarToggle_Unchecked" Margin="0,0,15,0">
                            <Grid Width="24" Height="24">
                                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                    <Rectangle Fill="{DynamicResource TextPrimaryBrush}" Height="3" Width="24" RadiusX="1.5" RadiusY="1.5" Margin="0,0,0,3" />
                                    <Rectangle Fill="{DynamicResource TextPrimaryBrush}" Height="3" Width="24" RadiusX="1.5" RadiusY="1.5" Margin="0,0,0,3" />
                                    <Rectangle Fill="{DynamicResource TextPrimaryBrush}" Height="3" Width="24" RadiusX="1.5" RadiusY="1.5" />
                                </StackPanel>
                            </Grid>
                        </ToggleButton>

                        <Ellipse Width="8" Height="8" Margin="0,0,8,0" VerticalAlignment="Center">
                            <Ellipse.Fill>
                                <RadialGradientBrush>
                                    <GradientStop Color="#8B5CF6" Offset="0" />
                                    <GradientStop Color="#6366F1" Offset="1" />
                                </RadialGradientBrush>
                            </Ellipse.Fill>
                            <Ellipse.Effect>
                                <DropShadowEffect Color="#8B5CF6" BlurRadius="8" ShadowDepth="0" Opacity="0.6" />
                            </Ellipse.Effect>
                        </Ellipse>

                        <TextBlock Text="Focus Timer" FontSize="18" FontWeight="Bold"
     Foreground="{DynamicResource TextPrimaryBrush}" VerticalAlignment="Center">
                            <TextBlock.Effect>
                                <DropShadowEffect Color="{DynamicResource PrimaryButtonColor}" BlurRadius="8" ShadowDepth="0" Opacity="0.4" />
                            </TextBlock.Effect>
                        </TextBlock>
                    </StackPanel>

                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                        <Button Style="{StaticResource WindowControlButton}" Click="MinimizeButton_Click" ToolTip="Hide to Tray">
                            <Path Data="M20,14H4V10H20" Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
          Width="14" Height="14" Stretch="Uniform" />
                        </Button>

                        <Button Style="{StaticResource CloseButton}" Click="CloseButton_Click" ToolTip="Exit Application" Margin="4,0,0,0">
                            <Path Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" 
         Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
           Width="14" Height="14" Stretch="Uniform" />
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- TIMER DISPLAY -->
            <Grid Grid.Row="1" Margin="20,25,20,15">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <Border Grid.Row="0" Background="{DynamicResource CardBackgroundBrush}"
             BorderBrush="{DynamicResource PrimaryButtonBrush}" BorderThickness="1"
        CornerRadius="16" Padding="14,8" HorizontalAlignment="Center" Margin="0,0,0,18">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <TextBlock Text="{Binding SelectedMode}" FontSize="12" FontWeight="SemiBold"
     Foreground="{DynamicResource PrimaryButtonBrush}" Margin="0,0,8,0" />
                        <TextBlock Text="&#x2022;" FontSize="12" FontWeight="SemiBold"
          Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,0,8,0" />
                        <TextBlock Text="{Binding CurrentPhase}" FontSize="12" FontWeight="SemiBold"
      Foreground="{DynamicResource TextSecondaryBrush}" />
                    </StackPanel>
                </Border>

                <Border Grid.Row="1" Background="{DynamicResource CardBackgroundBrush}"
             BorderBrush="{DynamicResource BorderBrush}" BorderThickness="2"
      CornerRadius="20" Padding="25,20" Margin="58,0,58,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <Viewbox Grid.Row="0" Width="200" Height="200">
                            <Grid Width="280" Height="280">
                                <!-- Background ring -->
                                <Ellipse Stroke="{DynamicResource ProgressBackgroundBrush}" 
    StrokeThickness="14" 
Width="280" Height="280" 
  Margin="0,31,0,-31" />

                                <!-- Animated progress ring (only for Pomodoro) -->
                                <Path x:Name="ProgressPath" 
 Stroke="{DynamicResource PrimaryButtonBrush}"
   StrokeThickness="14" 
        StrokeStartLineCap="Round" 
    StrokeEndLineCap="Round" 
   Margin="0,31,0,-31"
   Visibility="{Binding IsPomodoroMode, Converter={StaticResource BoolToVis}}">
                                    <Path.Data>
                                        <PathGeometry>
                                            <PathGeometry.Figures>
                                                <PathFigureCollection>
                                                    <PathFigure StartPoint="140,7">
                                                        <PathFigure.Segments>
                                                            <PathSegmentCollection>
                                                                <ArcSegment x:Name="ProgressArc" 
    Size="133,133"
 SweepDirection="Clockwise" 
  IsLargeArc="False" 
  Point="140,7" />
                                                            </PathSegmentCollection>
                                                        </PathFigure.Segments>
                                                    </PathFigure>
                                                </PathFigureCollection>
                                            </PathGeometry.Figures>
                                        </PathGeometry>
                                    </Path.Data>
                                    <Path.Effect>
                                        <DropShadowEffect Color="{DynamicResource PrimaryButtonColor}" 
BlurRadius="10" 
    ShadowDepth="0" 
           Opacity="0.6" />
                                    </Path.Effect>
                                </Path>

                                <!-- Full ring for Tracking mode -->
                                <Ellipse Stroke="{DynamicResource PrimaryButtonBrush}" 
            StrokeThickness="14" 
            Width="280" Height="280" 
            Margin="0,31,0,-31"
            Visibility="{Binding IsTrackingMode, Converter={StaticResource BoolToVis}}">
                                    <Ellipse.Effect>
                                        <DropShadowEffect Color="{DynamicResource PrimaryButtonColor}" 
  BlurRadius="10" 
ShadowDepth="0" 
Opacity="0.6" />
                                    </Ellipse.Effect>
                                </Ellipse>

                                <!-- Center time text -->
                                <TextBlock Text="{Binding TimeText}" 
    FontSize="52" 
FontWeight="Bold"
    Foreground="{DynamicResource TextPrimaryBrush}"
     HorizontalAlignment="Center" 
   VerticalAlignment="Center" 
     Margin="0,31,0,-31">
                                    <TextBlock.Effect>
                                        <DropShadowEffect Color="{DynamicResource PrimaryButtonColor}" 
       BlurRadius="12" 
    ShadowDepth="0" 
   Opacity="0.2" />
                                    </TextBlock.Effect>
                                </TextBlock>
                            </Grid>
                        </Viewbox>

                        <!-- Progress bar (only for Pomodoro) -->
                        <ProgressBar Grid.Row="1" Value="{Binding Progress}" Maximum="1"
      Style="{StaticResource ModernProgressBar}" Height="8" Margin="54,75,54,-88"
    Visibility="{Binding IsPomodoroMode, Converter={StaticResource BoolToVis}}" />
                    </Grid>
                </Border>

                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,20,0,0">
                    <!-- Start Button (visible when NOT started yet - centered alone) -->
                    <Button Content="Start" Width="100" Height="40" Command="{Binding StartCommand}"
            Style="{StaticResource PrimaryButton}"
    Visibility="{Binding CanPauseResume, Converter={StaticResource InverseBoolToVis}}" />

                    <!-- Pause/Resume Button (visible when started) -->
                    <Button Content="{Binding PauseButtonText}" Width="90" Height="40" Command="{Binding PauseCommand}"
  Style="{StaticResource ModernButton}"
   Visibility="{Binding CanPauseResume, Converter={StaticResource BoolToVis}}" Margin="0,0,8,0" />

                    <!-- Stop Button (visible only when started) -->
                    <Button Content="Stop" Width="90" Height="40" Command="{Binding StopCommand}"
        Style="{StaticResource ModernButton}" 
        Visibility="{Binding CanPauseResume, Converter={StaticResource BoolToVis}}" />
                </StackPanel>
            </Grid>

            <!-- FOOTER: MUSIC PLAYER ONLY -->
            <Border Grid.Row="2" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,1,0,0" Padding="0">

                <!-- Music Player Row -->
                <Border Background="{DynamicResource HeaderBackgroundBrush}"
BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0" Padding="15,10">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Grid Grid.Row="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,3">
                                    <Path Data="M12,3V12.26C11.5,12.09 11,12 10.5,12C8.01,12 6,14.01 6,16.5C6,18.99 8.01,21 10.5,21C12.99,21 15,18.99 15,16.5V6H19V3H12Z"
         Fill="{DynamicResource PrimaryButtonBrush}" Width="14" Height="14" Stretch="Uniform"
  Margin="0,0,6,0" VerticalAlignment="Center" />
                                    <TextBlock Text="Now Playing" FontSize="10" FontWeight="SemiBold"
      Foreground="{DynamicResource TextSecondaryBrush}" />
                                </StackPanel>
                                <TextBlock Text="{Binding SelectedTrack.Title, FallbackValue='No track selected'}"
      FontSize="12" FontWeight="Medium"
        Foreground="{DynamicResource TextPrimaryBrush}"
     TextTrimming="CharacterEllipsis" MaxWidth="280" />
                            </StackPanel>

                            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                <Button Width="32" Height="32" Command="{Binding AddTrackCommand}"
  Style="{StaticResource IconButton}" ToolTip="Add Track" Margin="2,0">
                                    <Path Data="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"
     Fill="{DynamicResource TextPrimaryBrush}" Width="12" Height="12" Stretch="Uniform"/>
                                </Button>

                                <!-- Play Button (visible when NOT playing) -->
                                <Button Width="32" Height="32" Command="{Binding PlaySelectedTrackCommand}"
 Style="{StaticResource IconButton}" ToolTip="Play" Margin="2,0"
         Visibility="{Binding IsPlaying, Converter={StaticResource InverseBoolToVis}}">
                                    <Path Data="M8,5.14V19.14L19,12.14L8,5.14Z"
    Fill="{DynamicResource PrimaryButtonBrush}" Width="12" Height="12" Stretch="Uniform"/>
                                </Button>

                                <!-- Pause Button (visible when playing) -->
                                <Button Width="32" Height="32" Command="{Binding StopPlaybackCommand}"
 Style="{StaticResource IconButton}" ToolTip="Pause" Margin="2,0"
         Visibility="{Binding IsPlaying, Converter={StaticResource BoolToVis}}">
                                    <Path Data="M14,19H18V5H14M6,19H10V5H6V19Z"
 Fill="{DynamicResource PrimaryButtonBrush}" Width="12" Height="12" Stretch="Uniform"/>
                                </Button>

                                <Button Width="32" Height="32" Command="{Binding RemoveSelectedTrackCommand}"
      Style="{StaticResource IconButton}" ToolTip="Remove Track" Margin="2,0">
                                    <Path Data="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"
  Fill="{DynamicResource TextSecondaryBrush}" Width="12" Height="12" Stretch="Uniform"/>
                                </Button>
                            </StackPanel>
                        </Grid>

                        <Border Grid.Row="1" Background="{DynamicResource CardBackgroundBrush}"
    BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1"
    CornerRadius="8" Padding="8" Margin="0,8,0,0" MaxHeight="100">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <ListBox ItemsSource="{Binding Tracks}"
    SelectedItem="{Binding SelectedTrack, Mode=TwoWay}"
 Background="Transparent" BorderThickness="0">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Title}"
     Foreground="{DynamicResource TextPrimaryBrush}"
         FontSize="11" Padding="5,3"/>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                    <ListBox.ItemContainerStyle>
                                        <Style TargetType="ListBoxItem">
                                            <Setter Property="Background" Value="Transparent"/>
                                            <Setter Property="BorderThickness" Value="0"/>
                                            <Setter Property="Padding" Value="5,2"/>
                                            <Style.Triggers>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter Property="Background" Value="{DynamicResource SecondaryButtonBrush}"/>
                                                    <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                                                </Trigger>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="{DynamicResource SecondaryButtonBrush}"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ListBox.ItemContainerStyle>
                                </ListBox>
                            </ScrollViewer>
                        </Border>
                    </Grid>
                </Border>
            </Border>
        </Grid>
    </Grid>
</Window>
